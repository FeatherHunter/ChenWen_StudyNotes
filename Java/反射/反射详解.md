
初稿，完成度：10%

# 反射详解

版本：2018/8/8-1(23:23)

----

[TOC]

1、Java中识别对象和类信息的两种方法？
>传统RTTI(它假定我们在编译时已经知道了所有的类型信息)；反射机制(它允许我们在运行时发现和使用类的信息)

2、RTTI(RunTime Type Information)是什么？
> 1. 所有的类型信息都必须在编译时已知。
> 2. 会在所有类第一次使用的时候，将class对象(保存在.class文件)动态加载到JVM。

3、 反射机制实现方法
>1. class类和reflect类库对反射进行了支持，通过里面的Field、Method和Constructor等类，能够确定对象信息，而在编译时不需要知道类的任何事情。
>2. 但是反射的.class文件在运行的时候也必须是已知的。
>3. .class文件可以在本地也可以通过网络获得。

4、 反射和RTTI的本质区别
>RTTI：编译器在编译时打开和检查.class文件
>反射：运行时打开和检查.class文件

5、JVM加载对象的方法
>类的信息会存在方法区，类加载器会通过方法区的类信息，在堆Heap上创建一个类对象(Class对象)，这个类对象是唯一的，后续的New等操作都是通过这个唯一的类对象作为模板去进行new等操作。

6、反射的特点
>1. 允许程序在运行时取得任何一个已知名称的class的内部信息，包括包括其modifiers(修饰符)，fields(属性)，methods(方法)等，并可于运行时改变fields内容或调用methods。
>2. 可以更灵活的编写代码，代码可以在运行时装配，无需在组件之间进行源代码链接，降低代码的耦合度
>3. 反射使用不当会造成很高的资源消耗！

## 使用

7、Class的获取方式
```java
        String msg = "Message";

        //1、通过对象调用getClass()方法来获取,通常应用在传过来一个Object对象,但是不知道其具体类型。
        Object obj = msg;
        Class c1 = obj.getClass();
        Log.i("reflect", "c1 Is = " +  c1.getName());

        //2、直接通过类的静态成员变量来获取。最可靠，最稳定，性能最高。
        Class c2 = String.class;
        Log.i("reflect", "c2 Is = " +  c2.getName());

        //3、通过Class的forName方法来获取。但可能抛出 ClassNotFoundException 异常。
        try {
            Class c3 = Class.forName("java.lang.String");
            Log.i("reflect", "c3 Is = " +  c3.getName());
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
            Log.i("reflect", "c3 's Class Not Found ");
        }
```
>一个类在 JVM 中只会有一个 Class 实例, 因此将c1,c2,c3进行 equals 比较，会发现为true。

8、Class常用API(一共64种)
>1. getName()：获得类的完整名字。
>1. getFields()：获得类的public类型的属性。
>1. getDeclaredFields()：获得类的所有属性。包括private 声明的和继承类
>1. getMethods()：获得类的public类型的方法。
>1. getDeclaredMethods()：获得类的所有方法。包括private 声明的和继承类
>1. getMethod(String name, Class[] parameterTypes)：获得类的特定方法，name参数指定方法的名字，parameterTypes 参数指定方法的参数类型。
>1. getConstructors()：获得类的public类型的构造方法。
>1. getConstructor(Class[] parameterTypes)：获得类的特定构造方法，parameterTypes 参数指定构造方法的参数类型。
>1. newInstance()：通过类的不带参数的构造方法创建这个类的一个对象。


## 参考资料
1. [反射简单介绍和简单实例](https://www.cnblogs.com/ysocean/p/6516248.html)
